<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Admin Panel | ShepherdNet</title>
Â  <link rel="icon" type="image/png" href="https://i.ibb.co/60bRQP5Z/Jewels-background-removed.png">
Â  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
Â  <style>
Â  Â  :root {Â 
Â  Â  Â  Â  /* Dark Mode (Default) */
Â  Â  Â  Â  --primary: #4facfe;Â 
Â  Â  Â  Â  --bg: #0f172a;
Â  Â  Â  Â  --glass: rgba(255, 255, 255, 0.05);Â 
Â  Â  Â  Â  --border: rgba(255, 255, 255, 0.1);Â 
Â  Â  Â  Â  --text: #ffffff;
Â  Â  Â  Â  --text-dim: rgba(255, 255, 255, 0.5);
Â  Â  }

Â  Â  [data-theme="light"] {
Â  Â  Â  Â  /* Light Mode */
Â  Â  Â  Â  --bg: #f1f5f9;
Â  Â  Â  Â  --glass: #ffffff;
Â  Â  Â  Â  --border: #e2e8f0;
Â  Â  Â  Â  --text: #0f172a;
Â  Â  Â  Â  --text-dim: #64748b;
Â  Â  }

Â  Â  * { box-sizing: border-box; margin: 0; padding: 0; }
Â  Â  body { background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; display: flex; min-height: 100vh; transition: 0.3s; }
Â  Â Â 
Â  Â  /* Sidebar */
Â  Â  nav { width: 280px; background: var(--glass); backdrop-filter: blur(15px); border-right: 1px solid var(--border); padding: 40px 20px; display: flex; flex-direction: column; }
Â  Â Â 
Â  Â  .profile-link {Â 
Â  Â  Â  Â  text-decoration: none; padding: 15px; background: rgba(79, 172, 254, 0.1);Â 
Â  Â  Â  Â  border-radius: 15px; margin-bottom: 40px; border: 1px solid var(--border);
Â  Â  Â  Â  transition: 0.3s; display: flex; align-items: center; gap: 12px;
Â  Â  }
Â  Â  .profile-link:hover { background: rgba(79, 172, 254, 0.2); transform: translateY(-2px); }
Â  Â  .nav-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; background: #1e293b; }
Â  Â Â 
Â  Â  .profile-info h2 { font-size: 0.6rem; color: var(--primary); margin: 0; letter-spacing: 1px; text-transform: uppercase; }
Â  Â  .profile-info p { font-size: 0.85rem; color: var(--text); margin: 2px 0 0 0; font-weight: 600; }

Â  Â  nav a { display: block; color: var(--text); text-decoration: none; padding: 12px 15px; border-radius: 12px; opacity: 0.7; transition: 0.3s; margin-bottom: 5px; font-size: 0.9rem; }
Â  Â  nav a:hover, nav a.active { opacity: 1; color: var(--primary); background: var(--glass); }

Â  Â  /* Theme Toggle Switch */
Â  Â  .theme-switch {
Â  Â  Â  Â  margin-top: 20px; padding: 12px 15px; border-radius: 12px;
Â  Â  Â  Â  background: var(--glass); border: 1px solid var(--border);
Â  Â  Â  Â  display: flex; align-items: center; justify-content: space-between;
Â  Â  Â  Â  font-size: 0.8rem; cursor: pointer;
Â  Â  }

Â  Â  /* Main Content */
Â  Â  main { flex: 1; padding: 60px; overflow-y: auto; }
Â  Â  #welcome-text { font-size: 2.5rem; font-weight: 300; margin-bottom: 5px; }
Â  Â  #welcome-name { color: var(--primary); font-weight: 600; }
Â  Â  .subtitle { opacity: 0.5; margin-bottom: 40px; color: var(--text-dim); }

Â  Â  .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 40px; }
Â  Â  .card { background: var(--glass); padding: 30px; border-radius: 24px; border: 1px solid var(--border); backdrop-filter: blur(10px); }
Â  Â  .card h3 { font-size: 0.8rem; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); }
Â  Â  .card p { font-size: 2.5rem; font-weight: bold; margin-top: 10px; color: var(--text); }
Â  Â Â 
Â  Â  .action-card { background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 0, 0, 0)); border-color: rgba(79, 172, 254, 0.3); }
Â  Â  .btn-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
Â  Â  button { background: var(--primary); color: #0f172a; border: none; padding: 14px 28px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: 0.3s; }
Â  Â  button:hover { transform: scale(1.05); }

Â  Â  #logoutBtn { color: #ff6b6b; margin-top: auto; padding: 12px 15px; text-decoration: none; font-size: 0.9rem; }
Â  </style>
</head>
<body>

Â  <nav>
Â  Â  <a href="../list/settings.html" class="profile-link">
Â  Â  Â  Â  <img id="nav-avatar" src="https://via.placeholder.com/40" class="nav-avatar">
Â  Â  Â  Â  <div class="profile-info">
Â  Â  Â  Â  Â  Â  <h2>Master Admin</h2>
Â  Â  Â  Â  Â  Â  <p id="nav-name">Loading...</p>
Â  Â  Â  Â  </div>
Â  Â  </a>
Â  Â  <a href="#" class="active">ğŸŒ General Overview</a>
Â  Â  <a href="../list/index.html">ğŸ“‹ All Church Members</a>
Â  Â  <a href="../dashboard/add-user.html">ğŸ”‘ Manage Users</a>

Â  Â  <div class="theme-switch" id="themeToggle">
Â  Â  Â  Â  <span>Theme Mode</span>
Â  Â  Â  Â  <span id="themeIcon">ğŸŒ™</span>
Â  Â  </div>

Â  Â  <div style="flex-grow: 1;"></div>
Â  Â  <a href="#" id="logoutBtn">ğŸšª Sign Out</a>
Â  </nav>

Â  <main>
Â  Â  <h1 id="welcome-text">Welcome, <span id="welcome-name">Admin</span></h1>
Â  Â  <p class="subtitle">System-wide analytics and management.</p>
Â  Â  <div id="birthday-alerts" style="margin-bottom: 30px;"></div>

Â  Â  <div class="stat-grid">
Â  Â  Â  <div class="card"><h3>Total Pastors</h3><p id="count-pastors">0</p></div>
Â  Â  Â  <div class="card"><h3>Total Shepherds</h3><p id="count-shepherds">0</p></div>
Â  Â  Â  <div class="card"><h3>Total Members</h3><p id="count-members">0</p></div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="card action-card">
Â  Â  Â  <h3>Quick Actions</h3>
Â  Â  Â  <div class="btn-group">
Â  Â  Â  Â  <button onclick="location.href='../dashboard/add-user.html'">Add New Pastor</button>
Â  Â  Â  Â  <button onclick="location.href='../dashboard/add-member.html'" style="background: rgba(255,255,255,0.1); color: var(--text); border: 1px solid var(--border);">Add New Member</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </main>

<script type="module">
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
Â  Â  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
Â  Â  import { initializeFirestore, doc, getDoc, collection, getCountFromServer, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

Â  Â  const firebaseConfig = {Â 
Â  Â  Â  Â  apiKey: "AIzaSyCBv60eRCO0e4dFBMKGKnIATouxTuk1Bcc",Â 
Â  Â  Â  Â  authDomain: "fob-database-139d1.firebaseapp.com",Â 
Â  Â  Â  Â  projectId: "fob-database-139d1",Â 
Â  Â  Â  Â  storageBucket: "fob-database-139d1.firebasestorage.app",Â 
Â  Â  Â  Â  messagingSenderId: "375165731354",Â 
Â  Â  Â  Â  appId: "1:375165731354:web:b5fa57dcb2d71ee0d8c7a3"Â 
Â  Â  };

Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  const auth = getAuth(app);
Â  Â  const db = initializeFirestore(app, { experimentalForceLongPolling: true }, "fobrealdbase");

Â  Â  // --- THEME LOGIC ---
Â  Â  const themeToggle = document.getElementById('themeToggle');
Â  Â  const themeIcon = document.getElementById('themeIcon');
Â  Â Â 
Â  Â  // Load saved theme
Â  Â  const savedTheme = localStorage.getItem('theme') || 'dark';
Â  Â  document.documentElement.setAttribute('data-theme', savedTheme);
Â  Â  themeIcon.innerText = savedTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';

Â  Â  themeToggle.addEventListener('click', () => {
Â  Â  Â  Â  const currentTheme = document.documentElement.getAttribute('data-theme');
Â  Â  Â  Â  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.documentElement.setAttribute('data-theme', newTheme);
Â  Â  Â  Â  localStorage.setItem('theme', newTheme);
Â  Â  Â  Â  themeIcon.innerText = newTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
Â  Â  });

Â  Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  Â  if (!user) { window.location.href = "../index.html"; return; }

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const adminSnap = await getDoc(doc(db, "pastors", user.uid));
Â  Â  Â  Â  Â  Â  if (adminSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  const data = adminSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('welcome-name').innerText = (data.full_name || "Admin").split(' ')[0];
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nav-name').innerText = data.full_name || "Admin";
Â  Â  Â  Â  Â  Â  Â  Â  if (data.profile_pic) document.getElementById('nav-avatar').src = data.profile_pic;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (err) { console.error(err); }

Â  Â  Â  Â  getStats();
Â  Â  Â  Â  checkBirthdays();
Â  Â  });

Â  Â  // ... (rest of your getStats and checkBirthdays functions remain the same) ...
Â  Â  async function getStats() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const [pCol, sCol, mCol] = await Promise.all([
Â  Â  Â  Â  Â  Â  Â  Â  getCountFromServer(collection(db, "pastors")),
Â  Â  Â  Â  Â  Â  Â  Â  getCountFromServer(collection(db, "shepherds")),
Â  Â  Â  Â  Â  Â  Â  Â  getCountFromServer(collection(db, "members"))
Â  Â  Â  Â  Â  Â  ]);
Â  Â  Â  Â  Â  Â  document.getElementById('count-pastors').innerText = pCol.data().count;
Â  Â  Â  Â  Â  Â  document.getElementById('count-shepherds').innerText = sCol.data().count;
Â  Â  Â  Â  Â  Â  document.getElementById('count-members').innerText = mCol.data().count;
Â  Â  Â  Â  } catch (e) { console.error(e); }
Â  Â  }

Â  Â  async function checkBirthdays() {
Â  Â  Â  Â  const alertContainer = document.getElementById('birthday-alerts');
Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  const gmtMonth = String(today.getUTCMonth() + 1).padStart(2, '0');
Â  Â  Â  Â  const gmtDay = String(today.getUTCDate()).padStart(2, '0');
Â  Â  Â  Â  const todayGMT = `${gmtMonth}-${gmtDay}`;

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const q = query(collection(db, "members"), where("dob_day_month", "==", todayGMT));
Â  Â  Â  Â  Â  Â  const querySnapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  if (querySnapshot.empty) { alertContainer.innerHTML = ""; return; }

Â  Â  Â  Â  Â  Â  let listHTML = "";
Â  Â  Â  Â  Â  Â  querySnapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = doc.data();
Â  Â  Â  Â  Â  Â  Â  Â  listHTML += `<li><strong>${data.first_name} ${data.last_name}</strong></li>`;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  alertContainer.innerHTML = `<div style="background: rgba(79, 172, 254, 0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 15px;"><h4 style="color: var(--primary);">ğŸ‰ Birthdays Today</h4><ul style="list-style: none; font-size: 0.85rem; margin-top:5px;">${listHTML}</ul></div>`;
Â  Â  Â  Â  } catch (e) { console.error(e); }
Â  Â  }

Â  Â  document.getElementById('logoutBtn').onclick = (e) => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  signOut(auth).then(() => window.location.href="../index.html");
Â  Â  };
</script>
</body>
</html>

