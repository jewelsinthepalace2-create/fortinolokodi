<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Member Profile | ShepherdNet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #4facfe; --accent: #00f2fe; --glass: rgba(255, 255, 255, 0.05); }
    body { background: #0f172a; color: white; font-family: 'Poppins', sans-serif; display: flex; justify-content: center; padding: 20px; min-height: 100vh; }
    
    .profile-card { width: 100%; max-width: 600px; background: var(--glass); padding: 30px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
    
    .header { text-align: center; margin-bottom: 30px; }
    h1 { color: var(--primary); font-weight: 600; margin-bottom: 5px; font-size: 1.8rem; }
    .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; background: rgba(79, 172, 254, 0.2); color: var(--accent); }

    .section-title { font-size: 0.7rem; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; margin: 25px 0 10px 0; display: block; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
    
    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .info-item { display: flex; flex-direction: column; }
    .full-width { grid-column: 1 / -1; }

    .label { color: #64748b; font-size: 0.75rem; margin-bottom: 2px; }
    .value { font-size: 1rem; color: #f1f5f9; word-break: break-word; }

    .notes-box { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; font-size: 0.9rem; line-height: 1.6; color: #cbd5e1; border: 1px solid rgba(255,255,255,0.05); }
    
    .back-btn { text-decoration: none; color: #888; font-size: 0.9rem; transition: 0.3s; display: inline-block; margin-bottom: 20px; }
    .back-btn:hover { color: var(--primary); }

    .call-btn { display: block; width: 100%; background: var(--primary); color: #0f172a; text-align: center; padding: 12px; border-radius: 12px; text-decoration: none; font-weight: 600; margin-top: 25px; }
  </style>
</head>
<body>

<div class="profile-card">
  <a href="index.html" class="back-btn">‚Üê Back to List</a>
  
  <div class="header">
    <h1 id="pName">Loading...</h1>
    <span class="badge" id="pStatus">Member Status</span>
  </div>

  <span class="section-title">Personal Details</span>
  <div class="info-grid">
    <div class="info-item">
      <span class="label">Gender</span>
      <span class="value" id="pGender">-</span>
    </div>
    <div class="info-item">
      <span class="label">Birthday</span>
      <span class="value" id="pBirthday">-</span>
    </div>
    <div class="info-item">
      <span class="label">Phone Number</span>
      <span class="value" id="pPhone">-</span>
    </div>
    <div class="info-item">
      <span class="label">Hostel / Residence</span>
      <span class="value" id="pHostel">-</span>
    </div>
  </div>

  <span class="section-title">Church Life</span>
  <div class="info-grid">
    <div class="info-item">
      <span class="label">Department</span>
      <span class="value" id="pDept">-</span>
    </div>
    <div class="info-item">
      <span class="label">Date Joined</span>
      <span class="value" id="pDateJoined">-</span>
    </div>
  </div>

  <span class="section-title">Emergency Contact</span>
  <div class="info-grid">
    <div class="info-item">
      <span class="label">Contact Person</span>
      <span class="value" id="pEmergencyName">-</span>
    </div>
    <div class="info-item">
      <span class="label">Emergency Phone</span>
      <span class="value" id="pEmergencyPhone">-</span>
    </div>
  </div>

  <span class="section-title">Spiritual Notes</span>
  <div class="notes-box" id="pNotes">No notes available for this member.</div>

  <a href="#" id="callLink" class="call-btn">Call Member Now</a>
  
  <p style="text-align:center; font-size:0.6rem; color:#334155; margin-top:30px;">
    MEMBER SYSTEM ID: <span id="pId">---</span>
  </p>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { initializeFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCBv60eRCO0e4dFBMKGKnIATouxTuk1Bcc",
    authDomain: "fob-database-139d1.firebaseapp.com",
    projectId: "fob-database-139d1",
    storageBucket: "fob-database-139d1.firebasestorage.app",
    messagingSenderId: "375165731354",
    appId: "1:375165731354:web:b5fa57dcb2d71ee0d8c7a3"
  };

  const app = initializeApp(firebaseConfig);
  const db = initializeFirestore(app, { experimentalForceLongPolling: true }, "fobrealdbase");

  async function loadProfile() {
    const urlParams = new URLSearchParams(window.location.search);
    const docId = urlParams.get('id');
    if (!docId) return;

    try {
      const docSnap = await getDoc(doc(db, "members", docId));
      if (docSnap.exists()) {
        const data = docSnap.data();
        
        // Populate UI
        document.getElementById('pName').textContent = data.full_name || "Unknown";
        document.getElementById('pStatus').textContent = data.status || "Regular Member";
        document.getElementById('pGender').textContent = data.gender || "Not Specified";
        document.getElementById('pBirthday').textContent = data.birthday || "Not Set";
        document.getElementById('pPhone').textContent = data.phone || "No Phone";
        document.getElementById('pHostel').textContent = data.hostel_level || "Not Provided";
        document.getElementById('pDept').textContent = data.department || "None";
        document.getElementById('pDateJoined').textContent = data.date_joined || "N/A";
        document.getElementById('pEmergencyName').textContent = data.emergency_contact_name || "-";
        document.getElementById('pEmergencyPhone').textContent = data.emergency_contact_phone || "-";
        
        if (data.notes) {
          document.getElementById('pNotes').textContent = data.notes;
        }

        document.getElementById('pId').textContent = docId;

        // Setup Call Button
        if (data.phone) {
          document.getElementById('callLink').href = `tel:${data.phone}`;
        } else {
          document.getElementById('callLink').style.display = "none";
        }
      } else {
        document.body.innerHTML = "<h1>Member not found</h1>";
      }
    } catch (e) {
      console.error(e);
    }
  }
  loadProfile();
</script>
</body>
</html>
